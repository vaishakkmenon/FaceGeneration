[INFO] Activating virtual environment...
[INFO] Upgrading pip...
Requirement already satisfied: pip in ./gan_env/lib/python3.10/site-packages (25.0.1)
[INFO] Installing PyTorch (CUDA 12.1) and dependencies...
Looking in indexes: https://download.pytorch.org/whl/cu121
Requirement already satisfied: torch in ./gan_env/lib/python3.10/site-packages (2.5.1+cu121)
Requirement already satisfied: torchvision in ./gan_env/lib/python3.10/site-packages (0.20.1+cu121)
Requirement already satisfied: torchaudio in ./gan_env/lib/python3.10/site-packages (2.5.1+cu121)
Requirement already satisfied: filelock in ./gan_env/lib/python3.10/site-packages (from torch) (3.13.1)
Requirement already satisfied: typing-extensions>=4.8.0 in ./gan_env/lib/python3.10/site-packages (from torch) (4.12.2)
Requirement already satisfied: networkx in ./gan_env/lib/python3.10/site-packages (from torch) (3.3)
Requirement already satisfied: jinja2 in ./gan_env/lib/python3.10/site-packages (from torch) (3.1.4)
Requirement already satisfied: fsspec in ./gan_env/lib/python3.10/site-packages (from torch) (2024.6.1)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.1.105 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.105)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.1.105 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.105)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.1.105 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.105)
Requirement already satisfied: nvidia-cudnn-cu12==9.1.0.70 in ./gan_env/lib/python3.10/site-packages (from torch) (9.1.0.70)
Requirement already satisfied: nvidia-cublas-cu12==12.1.3.1 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.3.1)
Requirement already satisfied: nvidia-cufft-cu12==11.0.2.54 in ./gan_env/lib/python3.10/site-packages (from torch) (11.0.2.54)
Requirement already satisfied: nvidia-curand-cu12==10.3.2.106 in ./gan_env/lib/python3.10/site-packages (from torch) (10.3.2.106)
Requirement already satisfied: nvidia-cusolver-cu12==11.4.5.107 in ./gan_env/lib/python3.10/site-packages (from torch) (11.4.5.107)
Requirement already satisfied: nvidia-cusparse-cu12==12.1.0.106 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.0.106)
Requirement already satisfied: nvidia-nccl-cu12==2.21.5 in ./gan_env/lib/python3.10/site-packages (from torch) (2.21.5)
Requirement already satisfied: nvidia-nvtx-cu12==12.1.105 in ./gan_env/lib/python3.10/site-packages (from torch) (12.1.105)
Requirement already satisfied: triton==3.1.0 in ./gan_env/lib/python3.10/site-packages (from torch) (3.1.0)
Requirement already satisfied: sympy==1.13.1 in ./gan_env/lib/python3.10/site-packages (from torch) (1.13.1)
Requirement already satisfied: nvidia-nvjitlink-cu12 in ./gan_env/lib/python3.10/site-packages (from nvidia-cusolver-cu12==11.4.5.107->torch) (12.1.105)
Requirement already satisfied: mpmath<1.4,>=1.1.0 in ./gan_env/lib/python3.10/site-packages (from sympy==1.13.1->torch) (1.3.0)
Requirement already satisfied: numpy in ./gan_env/lib/python3.10/site-packages (from torchvision) (2.1.2)
Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in ./gan_env/lib/python3.10/site-packages (from torchvision) (11.0.0)
Requirement already satisfied: MarkupSafe>=2.0 in ./gan_env/lib/python3.10/site-packages (from jinja2->torch) (2.1.5)
Requirement already satisfied: numpy in ./gan_env/lib/python3.10/site-packages (2.1.2)
Requirement already satisfied: matplotlib in ./gan_env/lib/python3.10/site-packages (3.10.1)
Requirement already satisfied: tqdm in ./gan_env/lib/python3.10/site-packages (4.67.1)
Requirement already satisfied: contourpy>=1.0.1 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (1.3.1)
Requirement already satisfied: cycler>=0.10 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (0.12.1)
Requirement already satisfied: fonttools>=4.22.0 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (4.57.0)
Requirement already satisfied: kiwisolver>=1.3.1 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (1.4.8)
Requirement already satisfied: packaging>=20.0 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (24.2)
Requirement already satisfied: pillow>=8 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (11.0.0)
Requirement already satisfied: pyparsing>=2.3.1 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (3.2.3)
Requirement already satisfied: python-dateutil>=2.7 in ./gan_env/lib/python3.10/site-packages (from matplotlib) (2.9.0.post0)
Requirement already satisfied: six>=1.5 in ./gan_env/lib/python3.10/site-packages (from python-dateutil>=2.7->matplotlib) (1.17.0)
[INFO] Running full_script.py with Distributed Data Parallel on 4 GPUs...
[INFO] Launching Training
[INFO] Process group initialized for rank 3
[INFO] Process group initialized for rank 1
[INFO] Initialized process group and set device for rank 3
cuda:3
[INFO] Resolved dataset path: /workspace/GAN-Models/data/mnist/
[INFO] Process group initialized for rank 2
[INFO] Process group initialized for rank 0
[INFO] Initialized process group and set device for rank 1
cuda:1
[INFO] Resolved dataset path: /workspace/GAN-Models/data/mnist/
[INFO] Returning Full Dataset for DDP
[INFO] Dataset loaded and DataLoader created on rank 3
[INFO] Moving models to device and wrapping with DDP on rank 3
[DEBUG] Initializing Generator and Discriminator models on rank 3
[INFO] Initialized process group and set device for rank 0
cuda:0
[INFO] Resolved dataset path: /workspace/GAN-Models/data/mnist/
[DEBUG] Models initialized on rank 3
[INFO] Returning Full Dataset for DDP
[INFO] Dataset loaded and DataLoader created on rank 1
[INFO] Moving models to device and wrapping with DDP on rank 1
[DEBUG] Initializing Generator and Discriminator models on rank 1
[DEBUG] Models initialized on rank 1
[INFO] Returning Full Dataset for DDP
[INFO] Dataset loaded and DataLoader created on rank 0
[INFO] Moving models to device and wrapping with DDP on rank 0
[DEBUG] Initializing Generator and Discriminator models on rank 0
[INFO] Initialized process group and set device for rank 2
cuda:2
[INFO] Resolved dataset path: /workspace/GAN-Models/data/mnist/
[INFO] Returning Full Dataset for DDP
[INFO] Dataset loaded and DataLoader created on rank 2
[INFO] Moving models to device and wrapping with DDP on rank 2
[DEBUG] Initializing Generator and Discriminator models on rank 2
[DEBUG] Models initialized on rank 2
[DEBUG] Models initialized on rank 0
[INFO] Models moved to device and wrapped in DDP on rank 1
[INFO] Models moved to device and wrapped in DDP on rank 0
[INFO] Models moved to device and wrapped in DDP on rank 2
[INFO] Models moved to device and wrapped in DDP on rank 3
/workspace/GAN-Models/model/GAN/full_script.py:189: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_G = GradScaler()
/workspace/GAN-Models/model/GAN/full_script.py:190: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_D = GradScaler()
[INFO] Starting epoch 0 on rank 1
/workspace/GAN-Models/model/GAN/full_script.py:189: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_G = GradScaler()
/workspace/GAN-Models/model/GAN/full_script.py:189: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_G = GradScaler()
/workspace/GAN-Models/model/GAN/full_script.py:190: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_D = GradScaler()
[INFO] Starting epoch 0 on rank 2
/workspace/GAN-Models/model/GAN/full_script.py:190: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_D = GradScaler()
[INFO] Starting epoch 0 on rank 0
/workspace/GAN-Models/model/GAN/full_script.py:189: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_G = GradScaler()
/workspace/GAN-Models/model/GAN/full_script.py:190: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler_D = GradScaler()
[INFO] Starting epoch 0 on rank 3
/workspace/GAN-Models/model/GAN/full_script.py:215: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with autocast():
/workspace/GAN-Models/model/GAN/full_script.py:215: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with autocast():
/workspace/GAN-Models/model/GAN/full_script.py:215: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with autocast():
/workspace/GAN-Models/model/GAN/full_script.py:215: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with autocast():
[rank0]:[W403 18:58:39.524909834 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())
W0403 18:58:41.083000 4832 torch/multiprocessing/spawn.py:160] Terminating process 4898 via signal SIGTERM
W0403 18:58:41.084000 4832 torch/multiprocessing/spawn.py:160] Terminating process 4899 via signal SIGTERM
W0403 18:58:41.084000 4832 torch/multiprocessing/spawn.py:160] Terminating process 4900 via signal SIGTERM
Traceback (most recent call last):
  File "/workspace/GAN-Models/model/GAN/full_script.py", line 281, in <module>
    mp.spawn(train, args=(world_size,), nprocs=world_size, join=True)
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/multiprocessing/spawn.py", line 328, in spawn
    return start_processes(fn, args, nprocs, join, daemon, start_method="spawn")
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/multiprocessing/spawn.py", line 284, in start_processes
    while not context.join():
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/multiprocessing/spawn.py", line 203, in join
    raise ProcessRaisedException(msg, error_index, failed_process.pid)
torch.multiprocessing.spawn.ProcessRaisedException: 

-- Process 0 terminated with the following error:
Traceback (most recent call last):
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/multiprocessing/spawn.py", line 90, in _wrap
    fn(i, *args)
  File "/workspace/GAN-Models/model/GAN/full_script.py", line 217, in train
    real_loss = criterion(D(imgs), valid)
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/nn/modules/loss.py", line 697, in forward
    return F.binary_cross_entropy(
  File "/workspace/GAN-Models/gan_env/lib/python3.10/site-packages/torch/nn/functional.py", line 3554, in binary_cross_entropy
    return torch._C._nn.binary_cross_entropy(input, target, weight, reduction_enum)
RuntimeError: torch.nn.functional.binary_cross_entropy and torch.nn.BCELoss are unsafe to autocast.
Many models use a sigmoid layer right before the binary cross entropy layer.
In this case, combine the two layers using torch.nn.functional.binary_cross_entropy_with_logits
or torch.nn.BCEWithLogitsLoss.  binary_cross_entropy_with_logits and BCEWithLogits are
safe to autocast.

[INFO] Training completed successfully.
